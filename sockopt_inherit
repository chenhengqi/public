[root@archlinux ~]# ./test_progs -t sockopt_inherit
Can't find bpf_testmod.ko kernel module: -2
WARNING! Selftests relying on bpf_testmod.ko will be skipped.
[   97.677390] CPU 0 Unable to handle kernel paging request at virtual address 0000000000000008, era == ffff80000202b8d0, ra == ffff80000202b8a4
[   97.677823] Oops[#1]:
[   97.677983] CPU: 0 PID: 250 Comm: test_progs Not tainted 6.7.0-rc2+ #20
[   97.678103] Hardware name: QEMU QEMU Virtual Machine, BIOS unknown 2/2/2022
[   97.678262] pc ffff80000202b8d0 ra ffff80000202b8a4 tp 90000001057ac000 sp 90000001057afc20
[   97.678397] a0 90000001048c53c8 a1 90000001057afcc0 a2 0000000000000000 a3 0000000000000001
[   97.678530] a4 0000000000000820 a5 0000000000000000 a6 0000000000000021 a7 0000000000000001
[   97.678662] t0 0000000000000000 t1 ffffffffffffefbf t2 90000001048c53c8 t3 0000000000000000
[   97.678796] t4 0000000000000001 t5 0000000000000001 t6 900000010533dd18 t7 0000000000000000
[   97.678927] t8 0000000000000000 u0 0000000000000000 s9 90000001057afc60 s0 90000001057afcf8
[   97.679060] s1 90000001057afcc0 s2 90000001057afcc0 s3 0000000000000000 s4 ffff80001b21c000
[   97.679193] s5 9000000004664000 s6 9000000004664000 s7 0000000000000001 s8 00007ffff269fd58
[   97.679362]    ra: ffff80000202b8a4 bpf_prog_4434f9c3089bdfd0__getsockopt+0x100/0x1b4
[   97.679720]   ERA: ffff80000202b8d0 bpf_prog_4434f9c3089bdfd0__getsockopt+0x12c/0x1b4
[   97.679856]  CRMD: 000000b0 (PLV0 -IE -DA +PG DACF=CC DACM=CC -WE)
[   97.680330]  PRMD: 00000004 (PPLV0 +PIE -PWE)
[   97.680435]  EUEN: 00000003 (+FPE +SXE -ASXE -BTE)
[   97.680555]  ECFG: 00071c1c (LIE=2-4,10-12 VS=7)
[   97.680682] ESTAT: 00020000 [PIS] (IS= ECode=2 EsubCode=0)
[   97.680796]  BADV: 0000000000000008
[   97.680876]  PRID: 0014c010 (Loongson-64bit, Loongson-3A5000)
[   97.680984] Modules linked in:
[   97.681078] Process test_progs (pid: 250, threadinfo=00000000a37eba49, task=000000008785512f)
[   97.681322] Stack : 9000000004664000 ffff80001b21c000 0000000000000001 90000001057afcc0
[   97.681505]         0000000000000001 9000000105cf0000 9000000104b12690 9000000002fed23c
[   97.681649]         900000000466a758 90000001057afcf8 0000000000000000 ffffffffffffffa1
[   97.681790]         00007ffff231e80f 0000000000000000 00007ffff231e810 0000000000000000
[   97.681932]         00007ffff231e80f 0000000000000000 9000000104b12690 00000000ffffffa1
[   97.682069]         9000000105cf0000 90000001057afcf8 90000001057afcf9 00000000deadbeef
[   97.682204]         0000000000000001 900000010047e5c0 0000000000000001 0000000000000000
[   97.682343]         0000000000000000 0000000000000000 0000000000000000 8495dd74bc044f28
[   97.682482]         0000000000000000 00007ffff269fd58 00007ffff231f180 9000000004664000
[   97.682632]         ffffffffffffffa1 0000000000000000 90000001022ca3c0 0000000000000000
[   97.682770]         ...
[   97.682842] Call Trace:
[   97.682980] [<ffff80000202b8d0>] bpf_prog_4434f9c3089bdfd0__getsockopt+0x12c/0x1b4
[   97.683439] [<9000000002fed23c>] __cgroup_bpf_run_filter_getsockopt+0x13c/0x55c
[   97.683718] [<9000000003d13e84>] do_sock_getsockopt+0x224/0x2a4
[   97.683823] [<9000000003d159ac>] __sys_getsockopt+0x94/0xec
[   97.683920] [<9000000003d15a1c>] sys_getsockopt+0x18/0x24
[   97.684020] [<9000000003feab68>] do_syscall+0x7c/0x94
[   97.684117] [<9000000002e21b1c>] handle_syscall+0xbc/0x158
[   97.684257]
[   97.684310] Code: 29c0c0ba  28c0a0ba  262ce35a <29802346> 28c0c0ba  2a000084  290002e4  02800409  16000009
[   97.684546]
[   97.684771] ---[ end trace 0000000000000000 ]---




[root@archlinux ~]# ./test_progs -t sockopt_inherit
Can't find bpf_testmod.ko kernel module: -2
WARNING! Selftests relying on bpf_testmod.ko will be skipped.
[  150.141474] CPU 1 Unable to handle kernel paging request at virtual address 0000000000000008, era == ffff80000202acdc, ra == ffff80000202acb0
[  150.142167] Oops[#1]:
[  150.142354] CPU: 1 PID: 277 Comm: test_progs Not tainted 6.7.0-rc2+ #20
[  150.142486] Hardware name: QEMU QEMU Virtual Machine, BIOS unknown 2/2/2022
[  150.142672] pc ffff80000202acdc ra ffff80000202acb0 tp 9000000101de0000 sp 9000000101de3c20
[  150.142824] a0 9000000104ff8ca8 a1 9000000101de3cc0 a2 0000000000000000 a3 00000000000000c8
[  150.142979] a4 9000000101de3a70 a5 0000000000000000 a6 0000000000000021 a7 0000000000000001
[  150.143130] t0 fffffffffffff000 t1 0000000000000001 t2 9000000104ff8ca8 t3 0000000000000008
[  150.143289] t4 000000000000004b t5 0000000000000001 t6 0000800000000000 t7 0000000000011b01
[  150.143442] t8 0000000000011c01 u0 00007ffff3ae0050 s9 9000000101de3c60 s0 9000000101de3cf8
[  150.143598] s1 9000000101de3cc0 s2 9000000101de3cc0 s3 0000000000000000 s4 ffff80001b21c000
[  150.143756] s5 9000000003ee4000 s6 9000000003ee4000 s7 0000000000000001 s8 00007ffff3ae0050
[  150.143919]    ra: ffff80000202acb0 bpf_prog_4434f9c3089bdfd0__getsockopt+0xfc/0x1b0
[  150.144283]   ERA: ffff80000202acdc bpf_prog_4434f9c3089bdfd0__getsockopt+0x128/0x1b0
[  150.144424]  CRMD: 000000b0 (PLV0 -IE -DA +PG DACF=CC DACM=CC -WE)
[  150.144916]  PRMD: 00000004 (PPLV0 +PIE -PWE)
[  150.145027]  EUEN: 00000003 (+FPE +SXE -ASXE -BTE)
[  150.145154]  ECFG: 00071c1c (LIE=2-4,10-12 VS=7)
[  150.145315] ESTAT: 00020000 [PIS] (IS= ECode=2 EsubCode=0)
[  150.145457]  BADV: 0000000000000008
[  150.145542]  PRID: 0014c010 (Loongson-64bit, Loongson-3A5000)
[  150.145650] Modules linked in:
[  150.145753] Process test_progs (pid: 277, threadinfo=0000000074bb9b9f, task=00000000bd63c2f1)
[  150.145994] Stack : 9000000003ee4000 ffff80001b21c000 0000000000000001 9000000101de3cc0
[  150.146186]         0000000000000001 9000000105e40900 9000000101bc9090 900000000286d23c
[  150.146398]         7fffffffffffffff 9000000101de3cf8 0000000000000000 ffffffffffffffa1
[  150.146562]         00007ffffbd3bc3f 0000000000000000 00007ffffbd3bc40 0000000000000000
[  150.146741]         00007ffffbd3bc3f 0000000000000000 9000000101bc9090 00000000ffffffa1
[  150.146886]         9000000105e40900 9000000101de3cf8 9000000101de3cf9 00000000deadbeef
[  150.147029]         0000000000000001 9000000105595fc0 0000000000000001 0000000000000000
[  150.147175]         0000000000000000 0000000000000000 0000000000000000 c9c63f0c76e17088
[  150.147314]         0000000000000000 00007ffff3ae0050 000055555805b610 9000000003ee4000
[  150.147458]         ffffffffffffffa1 0000000000000000 900000010237fa80 0000000000000000
[  150.147603]         ...
[  150.147679] Call Trace:
[  150.147829] [<ffff80000202acdc>] bpf_prog_4434f9c3089bdfd0__getsockopt+0x128/0x1b0
[  150.148206] [<900000000286d23c>] __cgroup_bpf_run_filter_getsockopt+0x13c/0x55c
[  150.148500] [<9000000003593e84>] do_sock_getsockopt+0x224/0x2a4
[  150.148606] [<90000000035959ac>] __sys_getsockopt+0x94/0xec
[  150.148723] [<9000000003595a1c>] sys_getsockopt+0x18/0x24
[  150.148823] [<900000000386ab68>] do_syscall+0x7c/0x94
[  150.148920] [<90000000026a1b1c>] handle_syscall+0xbc/0x158
[  150.149064]
[  150.149121] Code: 29c0c0ba  28c0a0ba  262ce35a <29802346> 28c0c0ba  2a000084  290002e4  02800409  16000009
[  150.149358]
[  150.149539] ---[ end trace 0000000000000000 ]---
[  150.150583] ------------[ cut here ]------------
[  150.150766] Voluntary context switch within RCU read-side critical section!
[  150.151099] WARNING: CPU: 1 PID: 277 at kernel/rcu/tree_plugin.h:320 rcu_note_context_switch+0x524/0x584
[  150.151669] Modules linked in:
[  150.151906] CPU: 1 PID: 277 Comm: test_progs Tainted: G      D            6.7.0-rc2+ #20
[  150.152112] Hardware name: QEMU QEMU Virtual Machine, BIOS unknown 2/2/2022
[  150.152281] pc 900000000275bee0 ra 900000000275bee0 tp 9000000101de0000 sp 9000000101de3770
[  150.152449] a0 000000000000003f a1 9000000003fd56d8 a2 9000000101de35b8 a3 9000000003fd56e0
[  150.152646] a4 9000000003fd56d8 a5 9000000101de35b0 a6 0000000000000001 a7 0000000000000001
[  150.152807] t0 c9c63f0c76e17088 t1 c9c63f0c76e17088 t2 0000000000000001 t3 0000000000000001
[  150.152969] t4 0000000000000004 t5 0000000000000000 t6 0000000000000030 t7 0000000000000000
[  150.153164] t8 0000000000024c37 u0 9000000003ccc140 s9 9000000101de3860 s0 9000000090829cc0
[  150.153346] s1 9000000105595fc0 s2 900000000393dcc0 s3 9000000105595fc0 s4 90000000040bb7d0
[  150.153503] s5 0000000000000000 s6 9000000101de3898 s7 9000000003ee4000 s8 0000000000000001
[  150.153691]    ra: 900000000275bee0 rcu_note_context_switch+0x524/0x584
[  150.153841]   ERA: 900000000275bee0 rcu_note_context_switch+0x524/0x584
[  150.153988]  CRMD: 000000b0 (PLV0 -IE -DA +PG DACF=CC DACM=CC -WE)
[  150.154199]  PRMD: 00000000 (PPLV0 -PIE -PWE)
[  150.154374]  EUEN: 00000000 (-FPE -SXE -ASXE -BTE)
[  150.154529]  ECFG: 00071c1c (LIE=2-4,10-12 VS=7)
[  150.154674] ESTAT: 000c0000 [BRK] (IS= ECode=12 EsubCode=0)
[  150.154836]  PRID: 0014c010 (Loongson-64bit, Loongson-3A5000)
[  150.155004] CPU: 1 PID: 277 Comm: test_progs Tainted: G      D            6.7.0-rc2+ #20
[  150.155147] Hardware name: QEMU QEMU Virtual Machine, BIOS unknown 2/2/2022
[  150.155358] Stack : 0072617764726148 0000000000000000 90000000026a3ea0 9000000101de0000
[  150.155601]         9000000101de33c0 9000000101de33c8 0000000000000000 9000000101de3508
[  150.155767]         9000000101de3500 9000000101de3500 9000000101de3330 0000000000000001
[  150.155944]         0000000000000001 9000000101de33c8 c9c63f0c76e17088 9000000100277080
[  150.156118]         0000000000000001 0000000000000004 0000000000000000 0000000000000030
[  150.156284]         0000000000000000 0000000000025e0b 000000008ceec000 9000000101de3860
[  150.156455]         0000000000000000 0000000000000000 9000000003d3ec38 9000000003ee4000
[  150.156620]         900000000275bee0 0000000000000140 9000000101de3898 9000000003ee4000
[  150.156795]         0000000000000001 0000000000000000 90000000026a3eb8 900000000275bee0
[  150.156952]         00000000000000b0 0000000000000000 0000000000000000 0000000000071c1c
[  150.157110]         ...
[  150.157192] Call Trace:
[  150.157292] [<90000000026a3eb8>] show_stack+0x5c/0x180
[  150.157657] [<9000000003869954>] dump_stack_lvl+0x60/0x88
[  150.157764] [<90000000026bf5d0>] __warn+0x84/0x164
[  150.157864] [<900000000381e830>] report_bug+0x1a4/0x20c
[  150.158013] [<900000000386aa10>] do_bp+0x254/0x330
[  150.158118] [<9000000100391924>] 0x9000000100391924
[  150.158427] [<900000000275bee0>] rcu_note_context_switch+0x524/0x584
[  150.158561] [<9000000003871484>] __schedule+0xa4/0xa00
[  150.158714] [<9000000003871e10>] schedule+0x30/0xd8
[  150.158827] [<9000000002759038>] synchronize_rcu_expedited+0x3f8/0x844
[  150.158957] [<90000000029a9ac0>] namespace_unlock+0xc4/0x164
[  150.159112] [<90000000029af13c>] put_mnt_ns+0xb4/0xf4
[  150.159203] [<90000000026eaf94>] free_nsproxy+0x1c/0x1bc
[  150.159338] [<90000000026c57a0>] do_exit+0x30c/0x904
[  150.159473] [<90000000026c5e24>] make_task_dead+0x8c/0x15c
[  150.159616] [<90000000026a40fc>] die+0x108/0x12c
[  150.159771] [<90000000026b410c>] do_page_fault+0x1e0/0x334
[  150.159892] [<90000000026b358c>] tlb_do_page_fault_1+0x118/0x1b4
[  150.160181] [<ffff80000202acb0>] bpf_prog_4434f9c3089bdfd0__getsockopt+0xfc/0x1b0
[  150.160415] [<900000000286d23c>] __cgroup_bpf_run_filter_getsockopt+0x13c/0x55c
[  150.160549] [<9000000003593e84>] do_sock_getsockopt+0x224/0x2a4
[  150.160672] [<90000000035959ac>] __sys_getsockopt+0x94/0xec
[  150.160781] [<9000000003595a1c>] sys_getsockopt+0x18/0x24
[  150.160876] [<900000000386ab68>] do_syscall+0x7c/0x94
[  150.161003] [<90000000026a1b1c>] handle_syscall+0xbc/0x158
[  150.161171]
[  150.161297] ---[ end trace 0000000000000000 ]---


[  171.159284] rcu: INFO: rcu_preempt detected stalls on CPUs/tasks:
[  171.159945] rcu:     Tasks blocked on level-0 rcu_node (CPUs 0-3): P277/1:b..l
[  171.160990] rcu:     (detected by 0, t=5252 jiffies, g=1017, q=112 ncpus=4)
[  171.161656] task:test_progs      state:D stack:0     pid:277   tgid:277   ppid:271    flags:0x00020808
[  171.162297] Stack : 0000000000000000 0000000000000000 9000000003871e10 0000000000000000
[  171.162710]         0000000000000002 0000000000000000 9000000003941b20 0000000000000000
[  171.163099]         0000000000000002 c9c63f0c76e17088 9000000003ee4000 00007ffff3ae0050
[  171.163484]         900000000452f000 9000000101de3898 9000000003ee4000 90000000040bb7d0
[  171.163872]         900000000452c8c0 900000000452f8c0 0000000000000080 9000000105595fc0
[  171.164261]         9000000101de3c60 9000000003871e10 900000000452ca50 9000000002759038
[  171.164636]         0000000000000080 0000000000000040 9000000101de3880 9000000101de3880
[  171.165013]         9000000002759d48 0000000000000000 9000000105595fc0 900000000271d864
[  171.165337]         900000000452ca58 900000000452ca58 900000000456ec30 9000000102778cc0
[  171.165672]         9000000101bc8700 0000000002000000 0000000008000000 0000000000000000
[  171.166014]         ...
[  171.166267] Call Trace:
[  171.166308] [<9000000003871764>] __schedule+0x384/0xa00
[  171.166721] [<9000000003871e10>] schedule+0x30/0xd8
[  171.166927] [<9000000002759038>] synchronize_rcu_expedited+0x3f8/0x844
[  171.167181] [<90000000029a9ac0>] namespace_unlock+0xc4/0x164
[  171.167400] [<90000000029af13c>] put_mnt_ns+0xb4/0xf4
[  171.167591] [<90000000026eaf94>] free_nsproxy+0x1c/0x1bc
[  171.167795] [<90000000026c57a0>] do_exit+0x30c/0x904
[  171.167986] [<90000000026c5e24>] make_task_dead+0x8c/0x15c
[  171.168211] [<90000000026a40fc>] die+0x108/0x12c
[  171.168391] [<90000000026b410c>] do_page_fault+0x1e0/0x334
[  171.168610] [<90000000026b358c>] tlb_do_page_fault_1+0x118/0x1b4
[  171.168854] [<ffff80000202acb0>] bpf_prog_4434f9c3089bdfd0__getsockopt+0xfc/0x1b0
[  171.169185] [<900000000286d23c>] __cgroup_bpf_run_filter_getsockopt+0x13c/0x55c
[  171.169454] [<9000000003593e84>] do_sock_getsockopt+0x224/0x2a4
[  171.169744] [<90000000035959ac>] __sys_getsockopt+0x94/0xec
[  171.170004] [<9000000003595a1c>] sys_getsockopt+0x18/0x24
[  171.170294] [<900000000386ab68>] do_syscall+0x7c/0x94
[  171.170499] [<90000000026a1b1c>] handle_syscall+0xbc/0x158
[  171.170737]
[  173.162011] rcu: INFO: rcu_preempt detected expedited stalls on CPUs/tasks: { P277 } 5753 jiffies s: 125 root: 0x0/T
[  173.164005] rcu: blocking rcu_node structures (internal RCU debug):
